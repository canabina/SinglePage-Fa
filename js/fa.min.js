function log(t){console.log(t)}$.fn.fa=function(t){function e(t,e){var n=this;this.currentActions={},this.viewSelector="",this.currentTemplateName="",this.ready=!0,this.localReady,this.pregMask={},this.ifMasks={},this.globalConter=0,this.globalIfCounter=0,this.listenHash=function(t){$(document).off("click",this.viewSelector+" > [fa-link]"),t?$(document).on("click",this.viewSelector+" > [fa-link]",function(t){$(this).attr("href")?window.onhashchange=function(t){n.route()}:(t.preventDefault(),window.history.pushState("/","","/"),n.route($(this).attr("href")))}):$(document).on("click",this.viewSelector+" > [fa-link]",function(t){t.preventDefault(),n.route($(this).attr("href"))})},this.getCurrentAction=function(t,e){if(e)var e=e.replace("/","");if(n.ready&&!t&&localStorage.getItem("currentAction"))var r=JSON.parse(localStorage.getItem("currentAction"));else{var i=JSON.parse(localStorage.getItem("currentAction"));if(i&&i.url)var a=i.url;var o=e?e:a&&!t&&this.ready?JSON.parse(localStorage.getItem("currentAction")).url:window.location.hash,s=this.helpers.clearEmptyItemsFromArray(this.helpers.explode("#",o)),r={};r=$.isEmptyObject(s)?{controller:"MainController",action:"actionIndex",url:o}:{controller:this.helpers.ucfirst(s[0])+"Controller",action:s[1]?"action"+this.helpers.ucfirst(s[1]):"actionIndex",url:o}}return t||localStorage.setItem("currentAction",JSON.stringify(r)),r},this.renderView=function(n){var r=!1;return"application"!=n?n&&$.ajax({url:t.viewPathUrl+n+".html",type:"GET",dataType:"html",async:!1,success:function(t){t&&(e.html(t),r=!0)},error:function(){console.warn("Template - "+n+".html is not load")}}):r=!0,r},this.ifListener=function(t){$(document).find(this.viewSelector+" > [fa-if]").each(function(e,r){var i=$(this).attr("fa-if");if(i){var a=i;if($.each(t,function(t,e){i.indexOf(t)>=0&&(e?isNaN(parseInt(e))&&(e='"'+e+'"'):e=0,a=a.replace(new RegExp(t.trim(),"g"),e))}),new Function("return ("+a.trim()+")")()){if($(this).hasClass("fa-disabled")){var o=n.ifMasks[$(this).attr("fa-if-index")];o&&$(this).html(o).removeClass("fa-disabled"),$(this).css("display","block")}}else{var s=$(this).attr("fa-if-index");s||($(this).attr("fa-if-index",n.globalIfCounter),$(this).html()&&(n.ifMasks[n.globalIfCounter]=$(this).html())),$(this).addClass("fa-disabled").html("").css("display","none"),n.globalIfCounter++}}}),n.updateAttrAndTextModels(t,!0)},this.modelListener=function(t,e,r){this.pregMask={},$(document).off("change keyup",this.viewSelector+" > [fa-object]"),$(document).off("click",this.viewSelector+" > [fa-click]");var i=t,a={},o=r,s=$(document).find(this.viewSelector).find("[fa-object]");return this.localReady&&s.length&&$.each(s,function(t,e){i[$(this).attr("fa-object")]=$(this).is("input")?$(this).val():$(this).text()}),t&&$.each(t,function(t,e){a[t]=e}),this.localReady&&(i=this.updateInModelScope(s,a,i)),$(document).on("change keyup",this.viewSelector+" > [fa-object]",function(t){t.preventDefault(),i[$(this).attr("fa-object")]=$(this).val();var r=e(o,i);i=r[1],o=r[0],n.updateModel(s,i),n.ifListener(i),n.updateAttrAndTextModels(i),n.stateListener(o)}),$(document).on("click",this.viewSelector+" > [fa-click]",function(t){t.preventDefault();var r=$(this).attr("fa-click").replace("()",""),a=e(o,i);a[1][r]?(a[1][r](o),i=a[1],o=a[0],n.updateModel(s,i),n.ifListener(i),n.updateAttrAndTextModels(i),n.stateListener(o)):console.warn('Function - "'+r+'()" is not defined')}),this.localReady||(this.updateAttrAndTextModels(i,!0),this.ifListener(i)),this.localReady?[i,o]:void 0},this.stateListener=function(e){if(e.redirect)if(t.enableHashUrl)window.history.pushState(e.redirect,"",e.redirect),this.route(e.redirect);else{var n=localStorage.getItem("currentAction");n=JSON.parse(n),n.url!=e.redirect&&this.route(e.redirect)}},this.updateAttrAndTextModels=function(t,e){e?$.each($(this.viewSelector+" > *"),function(e,r){if($.each(this.attributes,function(){if(this.specified&&this.value.indexOf("{{")>=0){$(r).addClass("fa-preg"+n.globalConter);var e=this.value;n.pregMask["fa-preg"+n.globalConter]={text:e,attr:this.name};var i=n.attrReplace(this.value,t);$(r).attr(this.name,i),n.globalConter++}}),$(this).text().indexOf("{{")>=0){$(this).addClass("fa-preg"+n.globalConter),n.pregMask["fa-preg"+n.globalConter]={text:$(this).text()};var i=n.attrReplace($(this).text(),t);$(r).text(i),n.globalConter++}}):n.pregMask&&$.each(n.pregMask,function(e,r){var i=n.attrReplace(r.text,t);r.attr?"value"==r.attr?$("."+e).val(i):$("."+e).attr(r.attr,i):$("."+e).text(i)})},this.attrReplace=function(t,e){var r=n.helpers.explode("{{",t),i="";return $.each(r,function(t,r){if(r.indexOf("}}")>=0){var a=n.helpers.explode("}}",r);if(r.indexOf("+")>=0||r.indexOf("-")>=0||r.indexOf("/")>=0||r.indexOf("*")>=0){for(var o=a[0],t=0;t<Object.keys(e).length;++t){var s=Object.keys(e)[t],c=e[Object.keys(e)[t]];(!c||isNaN(c))&&(c=0),c=parseInt(c),o.indexOf(s.trim())>=0&&(o=o.replace(new RegExp(s.trim(),"g"),c))}o&&(secondPart=new Function("return "+o)())}else secondPart=e[a[0]]?e[a[0]]:"";i+=secondPart+a[1],secondPart=""}else i+=r}),i},this.updateModel=function(t,e){$.each(t,function(t,n){$.each(e,function(t,e){$(n).attr("fa-object")==t&&$(n).val()!=e&&($(n).is("input")?$(n).val(e):$(n).text(e))})})},this.updateInModelScope=function(t,e,n){var n=n;return $.each(t,function(t,r){$.each(e,function(t,e){$(r).attr("fa-object")==t&&(n[t]=e,$(r).is("input")?$(r).val(e):$(r).text(e))})}),n},this.route=function(r){localStorage.getItem("currentAction")&&t.enableHashUrl&&localStorage.setItem("currentAction",!1),this.localReady=!0;var i={},a={};if(this.viewSelector=e.selector,this.listenHash(t.enableHashUrl),this.currentActions=this.getCurrentAction(t.enableHashUrl,r),$.isEmptyObject(t.controllers)&&(t.controllers={MainController:{actionIndex:{view:"application",execute:function(t,e){return[t,e]}}}}),t.controllers[this.currentActions.controller])if(t.controllers[this.currentActions.controller][this.currentActions.action]){var o=t.controllers[this.currentActions.controller][this.currentActions.action],s=o.view;if(s&&this.renderView(s)){var c=this.modelListener(i,o.execute,a),l=o.execute(a,c[0]);this.localReady=!1,this.modelListener(l[1],o.execute,a),t.debug&&t.debug(this),this.ready=!1,n.stateListener(l[0])}else console.warn("Select template in your action")}else console.warn("Controller - "+this.currentActions.action+" is not defined");else console.warn("Controller - "+this.currentActions.controller+" is not defined")},this.helpers={explode:function(t,e){var n={0:""};return 2!=arguments.length||"undefined"==typeof arguments[0]||"undefined"==typeof arguments[1]?null:""===t||t===!1||null===t?!1:"function"==typeof t||"object"==typeof t||"function"==typeof e||"object"==typeof e?n:(t===!0&&(t="1"),e.toString().split(t.toString()))},clearEmptyItemsFromArray:function(t){for(var e=[],n=0;n<t.length;n++)t[n]&&e.push(t[n]);return e},ucfirst:function(t){var e=t.charAt(0).toUpperCase();return e+t.substr(1,t.length-1)},isExpressionValue:function(t){return t.indexOf("<")>=0||t.indexOf(">")>=0||t.indexOf(">=")>=0||t.indexOf("=>")>=0||t.indexOf("===")>=0||t.indexOf("==")>=0||t.indexOf("&&")>=0||t.indexOf("||")>=0?!0:!1},isInt:function(t){return Number(t)===t&&t%1===0},replace:function(t,e,n){if(!(e instanceof Array)&&(e=new Array(e),t instanceof Array))for(;t.length>e.length;)e[e.length]=e[0];for(t instanceof Array||(t=new Array(t));t.length>e.length;)e[e.length]="";if(n instanceof Array){for(r in n)n[r]=str_replace(t,e,n[r]);return n}for(var r=0;r<t.length;r++)for(var i=n.indexOf(t[r]);i>-1;)n=n.replace(t[r],e[r]),i=n.indexOf(t[r],i);return n}}}t||(t={});var n=new e(t,this);n.route()};
